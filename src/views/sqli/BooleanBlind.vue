<template>
    <div class="root-div">
        <div class="vuln-info">
            <div class="header-div">SQLæ³¨å…¥ -- å¸ƒå°”ç›²æ³¨</div>
            <div class="body-div">
                <el-tabs v-model="activeName" @tab-click="handleClick">
                    <el-tab-pane label="æ¼æ´æè¿°" name="first">
                        <div class="vuln-detail">
                            <strong>å¸ƒå°”ç›²æ³¨ï¼ˆBoolean-Based Blind SQL Injectionï¼‰</strong>æ˜¯ä¸€ç§ç‰¹æ®Šçš„ SQL æ³¨å…¥ç±»å‹ã€‚ä¸æ™®é€š SQL
                            æ³¨å…¥ä¸åŒï¼Œå¸ƒå°”ç›²æ³¨çš„åº”ç”¨ç¨‹åº<span style="color: red;">ä¸ä¼šç›´æ¥è¿”å›æ•°æ®åº“æ•°æ®</span>ï¼Œè€Œæ˜¯åªè¿”å›<span
                                style="color: red;">"çœŸ"æˆ–"å‡"</span>ä¸¤ç§çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼š"ç”¨æˆ·åå·²å­˜åœ¨" / "ç”¨æˆ·åå¯ç”¨"ï¼‰ã€‚
                            <br /><br />
                            <strong>æ”»å‡»åŸç†ï¼š</strong><br />
                            1. æ”»å‡»è€…æ„é€ ç‰¹æ®Šçš„ SQL æ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆå¦‚ <code>AND 1=1</code>ã€<code>AND
                                SUBSTRING(password,1,1)='a'</code>ï¼‰<br />
                            2. æ ¹æ®åº”ç”¨ç¨‹åºè¿”å›çš„å¸ƒå°”å€¼ï¼ˆçœŸ/å‡ï¼‰æ¨æ–­æ•°æ®åº“ä¿¡æ¯<br />
                            3. é€šè¿‡å¤§é‡æ¡ä»¶æµ‹è¯•ï¼Œé€å­—ç¬¦çŒœæµ‹æ•æ„Ÿæ•°æ®ï¼ˆå¦‚å¯†ç ã€è¡¨åç­‰ï¼‰<br />
                            <br />
                            <strong>ç»å…¸åœºæ™¯ï¼š</strong>ç”¨æˆ·æ³¨å†Œæ—¶æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨<br />
                            <strong>ä¸æ—¶é—´ç›²æ³¨åŒºåˆ«ï¼š</strong>å¸ƒå°”ç›²æ³¨æ ¹æ®<span style="color: green;">é¡µé¢è¿”å›å†…å®¹å·®å¼‚</span>åˆ¤æ–­ï¼ˆå¿«é€Ÿï¼‰ï¼Œæ—¶é—´ç›²æ³¨æ ¹æ®<span
                                style="color: green;">å“åº”æ—¶é—´</span>åˆ¤æ–­ï¼ˆæ…¢é€Ÿï¼‰
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="æ¼æ´å±å®³" name="second">
                        <div class="vuln-detail">
                            å¸ƒå°”ç›²æ³¨è™½ç„¶æ— æ³•ç›´æ¥è·å–æ•°æ®ï¼Œä½†é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ sqlmapï¼‰å¯ä»¥å®ç°ï¼š<br /><br />
                            <strong>1. æ•°æ®åº“ä¿¡æ¯æ³„éœ²</strong><br />
                            &nbsp;&nbsp;&nbsp;&nbsp;- çŒœæµ‹æ•°æ®åº“ç‰ˆæœ¬ã€è¡¨åã€åˆ—å<br />
                            &nbsp;&nbsp;&nbsp;&nbsp;- é€å­—ç¬¦çˆ†ç ´ç”¨æˆ·å¯†ç ã€æ•æ„Ÿä¿¡æ¯<br /><br />
                            <strong>2. ç”¨æˆ·èº«ä»½æ³„éœ²</strong><br />
                            &nbsp;&nbsp;&nbsp;&nbsp;- é€šè¿‡"ç”¨æˆ·åæ˜¯å¦å­˜åœ¨"æ¥å£æšä¸¾ç³»ç»Ÿæ‰€æœ‰ç”¨æˆ·å<br />
                            &nbsp;&nbsp;&nbsp;&nbsp;- ä¸ºåç»­æ’åº“æ”»å‡»ã€ç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»æä¾›ç›®æ ‡<br /><br />
                            <strong>3. æ•°æ®å®Œæ•´æ€§éªŒè¯</strong><br />
                            &nbsp;&nbsp;&nbsp;&nbsp;- çŒœæµ‹æ•°æ®åº“è®°å½•æ€»æ•°<br />
                            &nbsp;&nbsp;&nbsp;&nbsp;- éªŒè¯ç‰¹å®šæ•°æ®æ˜¯å¦å­˜åœ¨<br /><br />
                            <strong>4. è‡ªåŠ¨åŒ–çˆ†ç ´</strong><br />
                            &nbsp;&nbsp;&nbsp;&nbsp;- ä½¿ç”¨å·¥å…·ï¼ˆsqlmapã€è‡ªå®šä¹‰è„šæœ¬ï¼‰å¯åœ¨æ•°å°æ—¶å†…å®Œæˆçˆ†ç ´<br />
                            &nbsp;&nbsp;&nbsp;&nbsp;- ç¤ºä¾‹ï¼šçˆ†ç ´ 32 ä½ MD5 å¯†ç é€šå¸¸éœ€è¦ 32Ã—16=512 æ¬¡è¯·æ±‚
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="å®‰å…¨ç¼–ç " name="third">
                        <div class="vuln-detail">
                            <strong>ã€å¿…é¡»ã€‘ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆPreparedStatementï¼‰</strong><br />
                            é¢„ç¼–è¯‘å¯ä»¥ç¡®ä¿ SQL è¯­å¥ç»“æ„åœ¨ç¼–è¯‘æ—¶å°±å·²ç¡®å®šï¼Œç”¨æˆ·è¾“å…¥ä»…ä½œä¸ºæ•°æ®å€¼ï¼Œæ— æ³•æ”¹å˜ SQL é€»è¾‘ã€‚<br /><br />

                            <strong>ã€å¿…é¡»ã€‘å±è”½è¯¦ç»†é”™è¯¯ä¿¡æ¯</strong><br />
                            ç¦æ­¢å°†æ•°æ®åº“é”™è¯¯ã€SQL è¯­å¥ç­‰æ•æ„Ÿä¿¡æ¯è¿”å›ç»™å‰ç«¯ï¼Œé¿å…æ”»å‡»è€…è·å–æ•°æ®åº“ç»“æ„ä¿¡æ¯ã€‚<br /><br />

                            <strong>ã€å»ºè®®ã€‘é™åˆ¶æŸ¥è¯¢é¢‘ç‡</strong><br />
                            å¯¹åŒä¸€ IP æˆ–ç”¨æˆ·çš„æŸ¥è¯¢è¯·æ±‚è¿›è¡Œé¢‘ç‡é™åˆ¶ï¼ˆå¦‚ 1 ç§’å†…æœ€å¤š 5 æ¬¡ï¼‰ï¼Œé˜²æ­¢è‡ªåŠ¨åŒ–çˆ†ç ´å·¥å…·æ”»å‡»ã€‚<br /><br />

                            <strong>ã€å»ºè®®ã€‘ä½¿ç”¨éªŒè¯ç </strong><br />
                            åœ¨æ•æ„Ÿæ¥å£ï¼ˆå¦‚ç”¨æˆ·åæ£€æŸ¥ï¼‰æ·»åŠ éªŒè¯ç æˆ–æ»‘åŠ¨éªŒè¯ï¼Œå¢åŠ è‡ªåŠ¨åŒ–æ”»å‡»éš¾åº¦ã€‚<br /><br />

                            <strong>ã€å»ºè®®ã€‘é¿å…æ˜ç¡®çš„å¸ƒå°”å“åº”</strong><br />
                            ä¸è¦è¿”å›"ç”¨æˆ·åå·²å­˜åœ¨"/"ç”¨æˆ·åå¯ç”¨"ç­‰æ˜ç¡®ä¿¡æ¯ï¼Œå¯ä»¥ç»Ÿä¸€è¿”å›"æäº¤æˆåŠŸï¼Œè¯·ç­‰å¾…å®¡æ ¸"ã€‚
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="å‚è€ƒæ–‡ç« " name="fourth">
                        <div class="vuln-detail">
                            <a href="https://portswigger.net/web-security/sql-injection/blind" target="_blank"
                                style="text-decoration: underline;">ã€ŠBlind SQL injectionã€‹</a> - PortSwigger å®˜æ–¹æ–‡æ¡£<br />
                            <a href="https://owasp.org/www-community/attacks/Blind_SQL_Injection" target="_blank"
                                style="text-decoration: underline;">ã€ŠBlind SQL Injectionã€‹</a> - OWASP å®‰å…¨æŒ‡å—<br />
                        </div>
                    </el-tab-pane>
                </el-tabs>
            </div>
        </div>

        <!-- ä»£ç æ¼”ç¤ºåŒºåŸŸ -->
        <div class="code-demo">
            <el-row :gutter="20" class="grid-flex">
                <!-- æ¼æ´ä»£ç  -->
                <el-col :span="12">
                    <div class="grid-content bg-purple">
                        <el-row type="flex" justify="space-between" align="middle">
                            æ¼æ´ä»£ç  - JDBCæ–¹å¼ - å­—ç¬¦ä¸²æ‹¼æ¥
                            <div>
                                <el-button type="danger" round size="mini" @click="openVulnDialog">
                                    å»æµ‹è¯•
                                </el-button>
                            </div>
                        </el-row>
                        <pre v-highlightjs><code class="java">/**
 * å¸ƒå°”ç›²æ³¨ - æ¼æ´ç‰ˆæœ¬
 * åœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œæ—¶æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²è¢«å ç”¨
 * æ¼æ´ï¼šç›´æ¥æ‹¼æ¥ SQLï¼Œå…è®¸æ³¨å…¥æ¡ä»¶åˆ¤æ–­è¯­å¥
 */
@GetMapping("/checkUserExistsVuln")
public Result checkUserExistsVuln(String username) {
    // 1. æ³¨å†Œé©±åŠ¨
    Class.forName("com.mysql.cj.jdbc.Driver");
    // 2. è·å–è¿æ¥
    Connection conn = DriverManager.getConnection(db_url, db_user, db_pass);
    // 3. âŒ æ‹¼æ¥ SQLï¼ˆæ¼æ´ç‚¹ï¼‰
    String sql = "SELECT COUNT(*) as count FROM admin " + 
                 "WHERE username = '" + username + "'";
    
    log.warn("ã€å¸ƒå°”ç›²æ³¨æ¼æ´ã€‘æ‰§è¡ŒSQL: {}", sql);
    
    // 4. æ‰§è¡ŒæŸ¥è¯¢
    Statement statement = conn.createStatement();
    ResultSet resultSet = statement.executeQuery(sql);
    
    // 5. åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    if (resultSet.next()) {
        int count = resultSet.getInt("count");
        boolean exists = count &gt; 0;
        return exists ? "âŒ ç”¨æˆ·åå·²å­˜åœ¨" : "âœ… ç”¨æˆ·åå¯ç”¨";
    }
}</code></pre>
                    </div>
                </el-col>

                <!-- å®‰å…¨ä»£ç  -->
                <el-col :span="12">
                    <div class="grid-content bg-purple">
                        <el-row type="flex" justify="space-between" align="middle">
                            å®‰å…¨ä»£ç  - JDBCæ–¹å¼ - é¢„ç¼–è¯‘
                            <div>
                                <el-button type="success" round size="mini" @click="openSecDialog">
                                    å»æµ‹è¯•
                                </el-button>
                            </div>
                        </el-row>
                        <pre v-highlightjs><code class="java">/**
 * å¸ƒå°”ç›²æ³¨ - å®‰å…¨ç‰ˆæœ¬
 * é˜²å¾¡æ–¹æ³•ï¼šä½¿ç”¨ PreparedStatement é¢„ç¼–è¯‘ + å‚æ•°ç»‘å®š
 * åŸç†ï¼šSQL ç»“æ„ç¼–è¯‘æ—¶ç¡®å®šï¼Œç”¨æˆ·è¾“å…¥ä»…ä½œä¸ºæ•°æ®å€¼
 */
@GetMapping("/checkUserExistsSec")
public Result checkUserExistsSec(String username) {
    // 1. æ³¨å†Œé©±åŠ¨
    Class.forName("com.mysql.cj.jdbc.Driver");
    // 2. è·å–è¿æ¥
    Connection conn = DriverManager.getConnection(db_url, db_user, db_pass);
    // 3. âœ… ä½¿ç”¨é¢„ç¼–è¯‘ï¼ˆå®‰å…¨ç‚¹ï¼‰
    String sql = "SELECT COUNT(*) as count FROM admin " + 
                 "WHERE username = ?";
    
    log.info("ã€å®‰å…¨ã€‘æ‰§è¡ŒSQL: {}, å‚æ•°: {}", sql, username);
    
    // 4. å‚æ•°ç»‘å®š
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setString(1, username);  // è‡ªåŠ¨è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
    
    // 5. æ‰§è¡ŒæŸ¥è¯¢
    ResultSet resultSet = ps.executeQuery();
    
    // 6. åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    if (resultSet.next()) {
        int count = resultSet.getInt("count");
        boolean exists = count &gt; 0;
        return exists ? "âŒ ç”¨æˆ·åå·²å­˜åœ¨" : "âœ… ç”¨æˆ·åå¯ç”¨";
    }
}</code></pre>
                    </div>
                </el-col>
            </el-row>

            <!-- MyBatis ç‰ˆæœ¬ -->
            <el-row :gutter="20" class="grid-flex" style="margin-top: 30px;">
                <!-- æ¼æ´ä»£ç  -->
                <el-col :span="12">
                    <div class="grid-content bg-purple">
                        <el-row type="flex" justify="space-between" align="middle">
                            æ¼æ´ä»£ç  - MyBatisæ–¹å¼ - ä½¿ç”¨ ${}
                            <div>
                                <el-button type="danger" round size="mini" @click="openVulnDialogMybatis">
                                    å»æµ‹è¯•
                                </el-button>
                            </div>
                        </el-row>
                        <pre v-highlightjs><code class="java">/**
 * å¸ƒå°”ç›²æ³¨ - æ¼æ´ç‰ˆæœ¬ï¼ˆMyBatisï¼‰
 * åœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œæ—¶æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²è¢«å ç”¨
 * æ¼æ´ï¼šä½¿ç”¨ ${} ç›´æ¥æ‹¼æ¥ SQL
 */
// Mapper æ¥å£
@Select("SELECT COUNT(*) FROM admin WHERE username = '\${username}'")
int checkUserExistsByDollar(@Param("username") String username);

// Controller
@GetMapping("/checkUserExistsVuln")
public Result checkUserExistsVuln(String username) {
    // âŒ è°ƒç”¨ä½¿ç”¨ ${} çš„ Mapper æ–¹æ³•
    int count = booleanBlindService.checkUserExistsByDollar(username);
    
    boolean exists = count &gt; 0;
    
    log.warn("ã€å¸ƒå°”ç›²æ³¨æ¼æ´-MyBatisã€‘æŸ¥è¯¢ç»“æœ: {}", exists);
    
    return exists ? "âŒ ç”¨æˆ·åå·²å­˜åœ¨" : "âœ… ç”¨æˆ·åå¯ç”¨";
}</code></pre>
                    </div>
                </el-col>

                <!-- å®‰å…¨ä»£ç  -->
                <el-col :span="12">
                    <div class="grid-content bg-purple">
                        <el-row type="flex" justify="space-between" align="middle">
                            å®‰å…¨ä»£ç  - MyBatisæ–¹å¼ - ä½¿ç”¨ #{}
                            <div>
                                <el-button type="success" round size="mini" @click="openSecDialogMybatis">
                                    å»æµ‹è¯•
                                </el-button>
                            </div>
                        </el-row>
                        <pre v-highlightjs><code class="java">/**
 * å¸ƒå°”ç›²æ³¨ - å®‰å…¨ç‰ˆæœ¬ï¼ˆMyBatisï¼‰
 * é˜²å¾¡æ–¹æ³•ï¼šä½¿ç”¨ MyBatis çš„ #{} è¿›è¡Œå‚æ•°ç»‘å®š
 * åŸç†ï¼š#{} åº•å±‚ä½¿ç”¨ PreparedStatement é¢„ç¼–è¯‘
 */
// Mapper æ¥å£
@Select("SELECT COUNT(*) FROM admin WHERE username = #{username}")
int checkUserExistsBySharp(@Param("username") String username);

// Controller
@GetMapping("/checkUserExistsSec")
public Result checkUserExistsSec(String username) {
    // âœ… è°ƒç”¨ä½¿ç”¨ #{} çš„ Mapper æ–¹æ³•
    int count = booleanBlindService.checkUserExistsBySharp(username);
    
    boolean exists = count &gt; 0;
    
    log.info("ã€å®‰å…¨-MyBatisã€‘æŸ¥è¯¢ç»“æœ: {}", exists);
    
    return exists ? "âŒ ç”¨æˆ·åå·²å­˜åœ¨" : "âœ… ç”¨æˆ·åå¯ç”¨";
}</code></pre>
                    </div>
                </el-col>
            </el-row>
        </div>

        <!-- æ¼æ´æµ‹è¯•å¯¹è¯æ¡† - JDBCç‰ˆæœ¬ -->
        <el-dialog title="ğŸ”´ ç”¨æˆ·æ³¨å†Œ - æ£€æŸ¥ç”¨æˆ·åï¼ˆæ¼æ´ç‰ˆï¼‰" :visible.sync="vulnDialogVisible" width="700px">
            <el-alert
                title="ğŸ’¡ å¸ƒå°”ç›²æ³¨æ”»å‡»æ¼”ç¤º"
                type="warning"
                :closable="false"
                style="margin-bottom: 20px;">
                <div style="line-height: 2;">
                    <strong>æ”»å‡»åˆ†æï¼š</strong><br />
                    1. æ³¨å…¥çš„æ¡ä»¶è¯­å¥æˆåŠŸæ‰§è¡Œï¼Œè¯´æ˜å­˜åœ¨ SQL æ³¨å…¥æ¼æ´<br />
                    2. æ ¹æ®ç”¨æˆ·åæ˜¯å¦å·²æ³¨å†Œï¼Œå¯ä»¥åˆ¤æ–­æ³¨å…¥æ¡ä»¶çš„çœŸå‡<br />
                    3. æ”»å‡»è€…å¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬ï¼Œè‡ªåŠ¨åŒ–çŒœæµ‹æ•°æ®åº“ä¸­çš„æ•æ„Ÿä¿¡æ¯<br />
                    <br />
                    <strong>æ­£å¸¸æµ‹è¯•ï¼š</strong>è¾“å…¥ <code>admin</code>ï¼ŒæŸ¥çœ‹æ˜¯å¦è¿”å›"ç”¨æˆ·åå·²å­˜åœ¨"<br />
                    <strong>å¸ƒå°”ç›²æ³¨æ”»å‡»ï¼š</strong>åˆ©ç”¨æ¡ä»¶åˆ¤æ–­é€å­—ç¬¦çŒœæµ‹æ•°æ®<br />
                    &nbsp;&nbsp;â€¢ <code>admin' AND SUBSTRING(password,1,1)='1' -- </code> çŒœæµ‹å¯†ç ç¬¬1ä½æ˜¯å¦ä¸º'1'<br />
                    &nbsp;&nbsp;â€¢ <code>admin' AND LENGTH(password)>=30 -- </code> çŒœæµ‹å¯†ç é•¿åº¦<br />
                    &nbsp;&nbsp;â€¢ <code>admin' AND SUBSTRING(VERSION(),1,1)='8' -- </code> çŒœæµ‹æ•°æ®åº“ç‰ˆæœ¬<br />
                </div>
            </el-alert>

            <!-- æ¨¡æ‹Ÿæ³¨å†Œè¡¨å• -->
            <div class="register-form">
                <el-form :model="vulnForm" label-width="100px">
                    <el-form-item label="ç”¨æˆ·å">
                        <el-input 
                            v-model="vulnForm.username" 
                            placeholder="è¯·è¾“å…¥è¦æ³¨å†Œçš„ç”¨æˆ·å"
                            clearable
                            style="width: 400px;">
                            <el-button 
                                slot="append" 
                                type="primary" 
                                @click="checkVulnUsername"
                                :loading="vulnChecking">
                                æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œ
                            </el-button>
                        </el-input>
                    </el-form-item>
                </el-form>

                <!-- æ£€æŸ¥ç»“æœæ˜¾ç¤º -->
                <div v-if="vulnResult.show" class="check-result">
                    <el-alert
                        :title="vulnResult.message"
                        :type="vulnResult.exists ? 'error' : 'success'"
                        :closable="false"
                        show-icon>
                    </el-alert>
                    
                    <!-- æ‰§è¡Œçš„ SQL è¯­å¥ -->
                    <div class="sql-display">
                        <div class="sql-label">ğŸ“ æ‰§è¡Œçš„ SQL è¯­å¥ï¼š</div>
                        <div class="sql-content" v-html="formatSql(vulnResult.sql)"></div>
                    </div>
                </div>

                <!-- å¿«é€Ÿæµ‹è¯•æŒ‰é’® -->
                <div class="quick-test">
                    <el-divider content-position="left">âš¡ å¿«é€Ÿæµ‹è¯•</el-divider>
                    <el-button size="small" @click="quickTest('admin')">
                        æ­£å¸¸ï¼šadmin
                    </el-button>
                    <el-button size="small" type="warning" @click="quickTest('admin\' AND SUBSTRING(password,1,1)=\'1\' -- ')">
                        æ”»å‡»ï¼šçŒœæµ‹å¯†ç ç¬¬1ä½='1'
                    </el-button>
                    <el-button size="small" type="warning" @click="quickTest('admin\' AND LENGTH(password)>=30 -- ')">
                        æ”»å‡»ï¼šçŒœæµ‹å¯†ç é•¿åº¦>=30
                    </el-button>
                </div>
            </div>
        </el-dialog>

        <!-- å®‰å…¨ç‰ˆæœ¬æµ‹è¯•å¯¹è¯æ¡† -->
        <el-dialog title="âœ… ç”¨æˆ·æ³¨å†Œ - æ£€æŸ¥ç”¨æˆ·åï¼ˆå®‰å…¨ç‰ˆï¼‰" :visible.sync="secDialogVisible" width="700px">
            <el-alert
                title=""
                type="success"
                :closable="false"
                style="margin-bottom: 20px;">
                <div style="line-height: 2;">
                    <strong>âœ… é˜²å¾¡åŸç†ï¼š</strong><br />
                    &nbsp;&nbsp;â€¢ PreparedStatement åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº† SQL ç»“æ„<br />
                    &nbsp;&nbsp;â€¢ ç”¨æˆ·è¾“å…¥é€šè¿‡å‚æ•°ç»‘å®šä¼ é€’ï¼Œä»…ä½œä¸ºæ•°æ®å€¼<br />
                    &nbsp;&nbsp;â€¢ å•å¼•å·ã€æ³¨é‡Šç¬¦ç­‰ç‰¹æ®Šå­—ç¬¦è¢«è½¬ä¹‰ä¸ºæ™®é€šå­—ç¬¦
                </div>
            </el-alert>

            <!-- æ¨¡æ‹Ÿæ³¨å†Œè¡¨å• -->
            <div class="register-form">
                <el-form :model="secForm" label-width="100px">
                    <el-form-item label="ç”¨æˆ·å">
                        <el-input 
                            v-model="secForm.username" 
                            placeholder="è¯·è¾“å…¥è¦æ³¨å†Œçš„ç”¨æˆ·å"
                            clearable
                            style="width: 400px;">
                            <el-button 
                                slot="append" 
                                type="success" 
                                @click="checkSecUsername"
                                :loading="secChecking">
                                æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œ
                            </el-button>
                        </el-input>
                    </el-form-item>
                </el-form>

                <!-- æ£€æŸ¥ç»“æœæ˜¾ç¤º -->
                <div v-if="secResult.show" class="check-result">
                    <el-alert
                        :title="secResult.message"
                        :type="secResult.exists ? 'error' : 'success'"
                        :closable="false"
                        show-icon>
                    </el-alert>
                    
                    <!-- æ‰§è¡Œçš„ SQL è¯­å¥ -->
                    <div class="sql-display">
                        <div class="sql-label">ğŸ“ æ‰§è¡Œçš„ SQL è¯­å¥ï¼š</div>
                        <div class="sql-content">{{ secResult.sql }}</div>
                    </div>
                </div>

                <!-- å¿«é€Ÿæµ‹è¯•æŒ‰é’® -->
                <div class="quick-test">
                    <el-divider content-position="left">âš¡ å¿«é€Ÿæµ‹è¯•</el-divider>
                    <el-button size="small" @click="quickTestSec('admin')">
                        æ­£å¸¸ï¼šadmin
                    </el-button>
                    <el-button size="small" type="warning" @click="quickTestSec('admin\' AND SUBSTRING(password,1,1)=\'1\' -- ')">
                        æ”»å‡»ï¼šçŒœæµ‹å¯†ç ç¬¬1ä½='1'
                    </el-button>
                    <el-button size="small" type="warning" @click="quickTestSec('admin\' AND LENGTH(password)>=30 -- ')">
                        æ”»å‡»ï¼šçŒœæµ‹å¯†ç é•¿åº¦>=30
                    </el-button>
                </div>
            </div>
        </el-dialog>

        <!-- MyBatis æ¼æ´æµ‹è¯•å¯¹è¯æ¡† -->
        <el-dialog title="ğŸ”´ ç”¨æˆ·æ³¨å†Œ - æ£€æŸ¥ç”¨æˆ·åï¼ˆMyBatis æ¼æ´ç‰ˆï¼‰" :visible.sync="vulnDialogVisibleMybatis" width="700px">
            <el-alert
                title="ğŸ’¡ å¸ƒå°”ç›²æ³¨æ”»å‡»æ¼”ç¤º - MyBatis ç‰ˆæœ¬"
                type="warning"
                :closable="false"
                style="margin-bottom: 20px;">
                <div style="line-height: 2;">
                    <strong>æ”»å‡»åˆ†æï¼š</strong><br />
                    1. MyBatis ä½¿ç”¨ <code>${'$'}{}</code> è¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢ï¼Œç›´æ¥æ‹¼æ¥åˆ° SQL ä¸­<br />
                    2. æ ¹æ®ç”¨æˆ·åæ˜¯å¦å·²æ³¨å†Œï¼Œå¯ä»¥åˆ¤æ–­æ³¨å…¥æ¡ä»¶çš„çœŸå‡<br />
                    3. æ”»å‡»è€…å¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬ï¼Œè‡ªåŠ¨åŒ–çŒœæµ‹æ•°æ®åº“ä¸­çš„æ•æ„Ÿä¿¡æ¯<br />
                    <br />
                    <strong>æ­£å¸¸æµ‹è¯•ï¼š</strong>è¾“å…¥ <code>admin</code>ï¼ŒæŸ¥çœ‹æ˜¯å¦è¿”å›"ç”¨æˆ·åå·²å­˜åœ¨"<br />
                    <strong>å¸ƒå°”ç›²æ³¨æ”»å‡»ï¼š</strong>åˆ©ç”¨æ¡ä»¶åˆ¤æ–­é€å­—ç¬¦çŒœæµ‹æ•°æ®<br />
                    &nbsp;&nbsp;â€¢ <code>admin' AND SUBSTRING(password,1,1)='1' -- </code> çŒœæµ‹å¯†ç ç¬¬1ä½æ˜¯å¦ä¸º'1'<br />
                    &nbsp;&nbsp;â€¢ <code>admin' AND LENGTH(password)>=30 -- </code> çŒœæµ‹å¯†ç é•¿åº¦<br />
                    &nbsp;&nbsp;â€¢ <code>admin' AND SUBSTRING(VERSION(),1,1)='8' -- </code> çŒœæµ‹æ•°æ®åº“ç‰ˆæœ¬<br />
                </div>
            </el-alert>

            <!-- æ¨¡æ‹Ÿæ³¨å†Œè¡¨å• -->
            <div class="register-form">
                <el-form :model="vulnFormMybatis" label-width="100px">
                    <el-form-item label="ç”¨æˆ·å">
                        <el-input 
                            v-model="vulnFormMybatis.username" 
                            placeholder="è¯·è¾“å…¥è¦æ³¨å†Œçš„ç”¨æˆ·å"
                            clearable
                            style="width: 400px;">
                            <el-button 
                                slot="append" 
                                type="primary" 
                                @click="checkVulnUsernameMybatis"
                                :loading="vulnCheckingMybatis">
                                æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œ
                            </el-button>
                        </el-input>
                    </el-form-item>
                </el-form>

                <!-- æ£€æŸ¥ç»“æœæ˜¾ç¤º -->
                <div v-if="vulnResultMybatis.show" class="check-result">
                    <el-alert
                        :title="vulnResultMybatis.message"
                        :type="vulnResultMybatis.exists ? 'error' : 'success'"
                        :closable="false"
                        show-icon>
                    </el-alert>
                    
                    <!-- æ‰§è¡Œçš„ SQL è¯­å¥ -->
                    <div class="sql-display">
                        <div class="sql-label">ğŸ“ æ‰§è¡Œçš„ SQL è¯­å¥ï¼š</div>
                        <div class="sql-content" v-html="formatSql(vulnResultMybatis.sql)"></div>
                    </div>
                </div>

                <!-- å¿«é€Ÿæµ‹è¯•æŒ‰é’® -->
                <div class="quick-test">
                    <el-divider content-position="left">âš¡ å¿«é€Ÿæµ‹è¯•</el-divider>
                    <el-button size="small" @click="quickTestMybatis('admin')">
                        æ­£å¸¸ï¼šadmin
                    </el-button>
                    <el-button size="small" type="warning" @click="quickTestMybatis('admin\' AND SUBSTRING(password,1,1)=\'1\' -- ')">
                        æ”»å‡»ï¼šçŒœæµ‹å¯†ç ç¬¬1ä½='1'
                    </el-button>
                    <el-button size="small" type="warning" @click="quickTestMybatis('admin\' AND LENGTH(password)>=30 -- ')">
                        æ”»å‡»ï¼šçŒœæµ‹å¯†ç é•¿åº¦>=30
                    </el-button>
                </div>
            </div>
        </el-dialog>

        <!-- MyBatis å®‰å…¨ç‰ˆæœ¬æµ‹è¯•å¯¹è¯æ¡† -->
        <el-dialog title="âœ… ç”¨æˆ·æ³¨å†Œ - æ£€æŸ¥ç”¨æˆ·åï¼ˆMyBatis å®‰å…¨ç‰ˆï¼‰" :visible.sync="secDialogVisibleMybatis" width="700px">
            <el-alert
                title=""
                type="success"
                :closable="false"
                style="margin-bottom: 20px;">
                <div style="line-height: 2;">
                    <strong>âœ… é˜²å¾¡åŸç†ï¼š</strong><br />
                    &nbsp;&nbsp;â€¢ MyBatis çš„ <code>#{}</code> åº•å±‚ä½¿ç”¨ PreparedStatement<br />
                    &nbsp;&nbsp;â€¢ SQL åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº†ç»“æ„ï¼Œç”¨æˆ·è¾“å…¥ä»…ä½œä¸ºå‚æ•°å€¼<br />
                    &nbsp;&nbsp;â€¢ å•å¼•å·ã€æ³¨é‡Šç¬¦ç­‰ç‰¹æ®Šå­—ç¬¦è¢«è‡ªåŠ¨è½¬ä¹‰
                </div>
            </el-alert>

            <!-- æ¨¡æ‹Ÿæ³¨å†Œè¡¨å• -->
            <div class="register-form">
                <el-form :model="secFormMybatis" label-width="100px">
                    <el-form-item label="ç”¨æˆ·å">
                        <el-input 
                            v-model="secFormMybatis.username" 
                            placeholder="è¯·è¾“å…¥è¦æ³¨å†Œçš„ç”¨æˆ·å"
                            clearable
                            style="width: 400px;">
                            <el-button 
                                slot="append" 
                                type="success" 
                                @click="checkSecUsernameMybatis"
                                :loading="secCheckingMybatis">
                                æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œ
                            </el-button>
                        </el-input>
                    </el-form-item>
                </el-form>

                <!-- æ£€æŸ¥ç»“æœæ˜¾ç¤º -->
                <div v-if="secResultMybatis.show" class="check-result">
                    <el-alert
                        :title="secResultMybatis.message"
                        :type="secResultMybatis.exists ? 'error' : 'success'"
                        :closable="false"
                        show-icon>
                    </el-alert>
                    
                    <!-- æ‰§è¡Œçš„ SQL è¯­å¥ -->
                    <div class="sql-display">
                        <div class="sql-label">ğŸ“ æ‰§è¡Œçš„ SQL è¯­å¥ï¼š</div>
                        <div class="sql-content">{{ secResultMybatis.sql }}</div>
                    </div>
                </div>

                <!-- å¿«é€Ÿæµ‹è¯•æŒ‰é’® -->
                <div class="quick-test">
                    <el-divider content-position="left">âš¡ å¿«é€Ÿæµ‹è¯•</el-divider>
                    <el-button size="small" @click="quickTestSecMybatis('admin')">
                        æ­£å¸¸ï¼šadmin
                    </el-button>
                    <el-button size="small" type="warning" @click="quickTestSecMybatis('admin\' AND SUBSTRING(password,1,1)=\'1\' -- ')">
                        æ”»å‡»ï¼šçŒœæµ‹å¯†ç ç¬¬1ä½='1'
                    </el-button>
                    <el-button size="small" type="warning" @click="quickTestSecMybatis('admin\' AND LENGTH(password)>=30 -- ')">
                        æ”»å‡»ï¼šçŒœæµ‹å¯†ç é•¿åº¦>=30
                    </el-button>
                </div>
            </div>
        </el-dialog>
    </div>
</template>

<script>
import { 
  checkUserExistsVulnJdbc, 
  checkUserExistsSecJdbc,
  checkUserExistsVulnMybatis,
  checkUserExistsSecMybatis
} from '@/api/sqli';

export default {
    data() {
        return {
            activeName: 'first',
            vulnDialogVisible: false,
            secDialogVisible: false,
            vulnDialogVisibleMybatis: false,
            secDialogVisibleMybatis: false,
            vulnForm: {
                username: ''
            },
            secForm: {
                username: ''
            },
            vulnFormMybatis: {
                username: ''
            },
            secFormMybatis: {
                username: ''
            },
            vulnResult: {
                show: false,
                exists: false,
                message: '',
                sql: ''
            },
            secResult: {
                show: false,
                exists: false,
                message: '',
                sql: ''
            },
            vulnResultMybatis: {
                show: false,
                exists: false,
                message: '',
                sql: ''
            },
            secResultMybatis: {
                show: false,
                exists: false,
                message: '',
                sql: ''
            },
            vulnChecking: false,
            secChecking: false,
            vulnCheckingMybatis: false,
            secCheckingMybatis: false
        };
    },
    methods: {
        handleClick(tab, event) {
            // Tab åˆ‡æ¢äº‹ä»¶
        },
        openVulnDialog() {
            this.vulnDialogVisible = true;
            this.vulnForm.username = '';
            this.vulnResult.show = false;
        },
        openSecDialog() {
            this.secDialogVisible = true;
            this.secForm.username = '';
            this.secResult.show = false;
        },
        // æ£€æŸ¥ç”¨æˆ·åï¼ˆæ¼æ´ç‰ˆï¼‰
        async checkVulnUsername() {
            if (!this.vulnForm.username) {
                this.$message.warning('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }

            this.vulnChecking = true;
            try {
                const res = await checkUserExistsVulnJdbc({ username: this.vulnForm.username });

                if (res.code === 0) {
                    this.vulnResult = {
                        show: true,
                        exists: res.data.exists,
                        message: res.data.message,
                        sql: res.data.sql
                    };
                } else {
                    this.$message.error(res.msg || 'æŸ¥è¯¢å¤±è´¥');
                }
            } catch (error) {
                this.$message.error('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            } finally {
                this.vulnChecking = false;
            }
        },
        // æ£€æŸ¥ç”¨æˆ·åï¼ˆå®‰å…¨ç‰ˆï¼‰
        async checkSecUsername() {
            if (!this.secForm.username) {
                this.$message.warning('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }

            this.secChecking = true;
            try {
                const res = await checkUserExistsSecJdbc({ username: this.secForm.username });

                if (res.code === 0) {
                    this.secResult = {
                        show: true,
                        exists: res.data.exists,
                        message: res.data.message,
                        sql: res.data.sql
                    };
                } else {
                    this.$message.error(res.msg || 'æŸ¥è¯¢å¤±è´¥');
                }
            } catch (error) {
                this.$message.error('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            } finally {
                this.secChecking = false;
            }
        },
        // å¿«é€Ÿæµ‹è¯•ï¼ˆæ¼æ´ç‰ˆï¼‰
        quickTest(username) {
            this.vulnForm.username = username;
            this.checkVulnUsername();
        },
        // å¿«é€Ÿæµ‹è¯•ï¼ˆå®‰å…¨ç‰ˆï¼‰
        quickTestSec(username) {
            this.secForm.username = username;
            this.checkSecUsername();
        },
        // æ ¼å¼åŒ– SQL æ˜¾ç¤ºï¼ˆé«˜äº®å‚æ•°ï¼‰
        formatSql(sql) {
            if (!sql) return '';
            // é«˜äº®æ˜¾ç¤ºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†
            const match = sql.match(/WHERE username = '(.+?)'/);
            if (match && match[1]) {
                const userInput = match[1];
                return sql.replace(
                    userInput,
                    '<span class="sql-highlight">' + userInput + '</span>'
                );
            }
            return sql;
        },
        // MyBatis - æ‰“å¼€æ¼æ´å¯¹è¯æ¡†
        openVulnDialogMybatis() {
            this.vulnDialogVisibleMybatis = true;
            this.vulnFormMybatis.username = '';
            this.vulnResultMybatis.show = false;
        },
        // MyBatis - æ‰“å¼€å®‰å…¨å¯¹è¯æ¡†
        openSecDialogMybatis() {
            this.secDialogVisibleMybatis = true;
            this.secFormMybatis.username = '';
            this.secResultMybatis.show = false;
        },
        // MyBatis - æ£€æŸ¥ç”¨æˆ·åï¼ˆæ¼æ´ç‰ˆï¼‰
        async checkVulnUsernameMybatis() {
            if (!this.vulnFormMybatis.username) {
                this.$message.warning('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }

            this.vulnCheckingMybatis = true;
            try {
                const res = await checkUserExistsVulnMybatis({ username: this.vulnFormMybatis.username });

                if (res.code === 0) {
                    this.vulnResultMybatis = {
                        show: true,
                        exists: res.data.exists,
                        message: res.data.message,
                        sql: res.data.sql
                    };
                } else {
                    this.$message.error(res.msg || 'æŸ¥è¯¢å¤±è´¥');
                }
            } catch (error) {
                this.$message.error('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            } finally {
                this.vulnCheckingMybatis = false;
            }
        },
        // MyBatis - æ£€æŸ¥ç”¨æˆ·åï¼ˆå®‰å…¨ç‰ˆï¼‰
        async checkSecUsernameMybatis() {
            if (!this.secFormMybatis.username) {
                this.$message.warning('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }

            this.secCheckingMybatis = true;
            try {
                const res = await checkUserExistsSecMybatis({ username: this.secFormMybatis.username });

                if (res.code === 0) {
                    this.secResultMybatis = {
                        show: true,
                        exists: res.data.exists,
                        message: res.data.message,
                        sql: res.data.sql
                    };
                } else {
                    this.$message.error(res.msg || 'æŸ¥è¯¢å¤±è´¥');
                }
            } catch (error) {
                this.$message.error('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            } finally {
                this.secCheckingMybatis = false;
            }
        },
        // MyBatis - å¿«é€Ÿæµ‹è¯•ï¼ˆæ¼æ´ç‰ˆï¼‰
        quickTestMybatis(username) {
            this.vulnFormMybatis.username = username;
            this.checkVulnUsernameMybatis();
        },
        // MyBatis - å¿«é€Ÿæµ‹è¯•ï¼ˆå®‰å…¨ç‰ˆï¼‰
        quickTestSecMybatis(username) {
            this.secFormMybatis.username = username;
            this.checkSecUsernameMybatis();
        }
    }
};
</script>

<style scoped>
.vuln-info {
    border-radius: 10px;
    margin: 20px;
    margin-top: 10px;
}

.header-div {
    font-size: 24px;
    color: #409EFF;
    font-weight: bold;
    padding: 10px;
    justify-content: center;
    align-items: center;
    border-bottom: 1px solid #ccc;
}

.body-div {
    padding: 10px;
    justify-content: center;
    align-items: center;
    font-family: Arial, sans-serif;
    font-size: 14px;
}

.vuln-detail {
    background-color: #dce9f8;
    padding: 10px;
    line-height: 1.8;
}

.vuln-detail code {
    background-color: #f0f0f0;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    color: #e74c3c;
}

.code-demo {
    margin: 20px;
    border-top: 1px solid #ccc;
    padding-top: 20px;
}

pre code {
    font-size: 12px;
}

.el-row {
    margin-bottom: 20px;
}

.el-row:last-child {
    margin-bottom: 0;
}

.el-col {
    border-radius: 4px;
}

.bg-purple {
    background: #d3dce6;
}

.grid-content {
    border-radius: 4px;
    height: 100%;
    padding: 10px;
}

.grid-flex {
    display: flex;
    align-items: stretch;
}

/* å¯¹è¯æ¡†æ ·å¼ */
.register-form {
    padding: 10px;
}

.check-result {
    margin-top: 20px;
}

.sql-display {
    margin-top: 15px;
    padding: 15px;
    background-color: #f9f9f9;
    border-left: 4px solid #409EFF;
    border-radius: 4px;
}

.sql-label {
    font-weight: bold;
    color: #409EFF;
    margin-bottom: 8px;
}

.sql-content {
    font-family: 'Courier New', monospace;
    background-color: #fff;
    padding: 10px;
    border-radius: 4px;
    word-break: break-all;
    color: #333;
}

.sql-highlight {
    color: #e74c3c;
    font-weight: bold;
    background-color: #ffe6e6;
    padding: 2px 4px;
    border-radius: 3px;
}

.attack-demo {
    margin-top: 20px;
    padding: 15px;
    background-color: #fff3e0;
    border-left: 4px solid #ff9800;
    border-radius: 4px;
}

.attack-explanation {
    line-height: 1.8;
    color: #666;
}

.defense-demo {
    margin-top: 20px;
    padding: 15px;
    background-color: #e8f5e9;
    border-left: 4px solid #4caf50;
    border-radius: 4px;
}

.defense-explanation {
    line-height: 1.8;
    color: #666;
}

.quick-test {
    margin-top: 20px;
}

.quick-test .el-button {
    margin-right: 10px;
    margin-bottom: 10px;
}
</style>
